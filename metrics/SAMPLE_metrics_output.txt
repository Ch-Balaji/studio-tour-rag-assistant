====================================================================================================
                                   PERFORMANCE METRICS SUMMARY
====================================================================================================

────────────────────────────────────────────────────────────────────────────────────────────────────
Query #1: Who is Harry Potter's best friend?
────────────────────────────────────────────────────────────────────────────────────────────────────

Component                                Time (ms)       Time (s)        Details
---------------------------------------- --------------- --------------- ------------------------------
1. Query Enhancement                     0.36            0.0004         
2. Retrieval Pipeline (Total)            57.86           0.0579          5 chunks
   • Query Embedding                     29.30           0.0293         
   • Dense Retrieval (Vector)            8.77            0.0088         
   • Sparse Retrieval (Bm25)             19.35           0.0194         
   • Rrf Fusion                          0.01            0.0000         
   • Reranking                           146.98          0.1470         
3. Context Formatting                    0.01            0.0000          2986 chars
4. LLM Generation (Total)                1245.32         1.2453          127 tokens
   • Time to First Token                 89.45           0.0895         

----------------------------------------------------------------------------------------------------
TOTAL PIPELINE TIME                      1303.55         1.3036         
----------------------------------------------------------------------------------------------------

────────────────────────────────────────────────────────────────────────────────────────────────────
Query #2: What is the Patronus charm and how does it work?
────────────────────────────────────────────────────────────────────────────────────────────────────

Component                                Time (ms)       Time (s)        Details
---------------------------------------- --------------- --------------- ------------------------------
1. Query Enhancement                     0.28            0.0003         
2. Retrieval Pipeline (Total)            62.15           0.0622          5 chunks
   • Query Embedding                     31.45           0.0315         
   • Dense Retrieval (Vector)            9.12            0.0091         
   • Sparse Retrieval (Bm25)             18.87           0.0189         
   • Rrf Fusion                          0.02            0.0000         
   • Reranking                           152.34          0.1523         
3. Context Formatting                    0.02            0.0000          3142 chars
4. LLM Generation (Total)                1876.45         1.8764          203 tokens
   • Time to First Token                 92.18           0.0922         

----------------------------------------------------------------------------------------------------
TOTAL PIPELINE TIME                      1938.90         1.9389         
----------------------------------------------------------------------------------------------------

────────────────────────────────────────────────────────────────────────────────────────────────────
Query #3: Describe the Battle of Hogwarts
────────────────────────────────────────────────────────────────────────────────────────────────────

Component                                Time (ms)       Time (s)        Details
---------------------------------------- --------------- --------------- ------------------------------
1. Query Enhancement                     0.32            0.0003         
2. Retrieval Pipeline (Total)            59.23           0.0592          5 chunks
   • Query Embedding                     30.12           0.0301         
   • Dense Retrieval (Vector)            8.95            0.0090         
   • Sparse Retrieval (Bm25)             19.01           0.0190         
   • Rrf Fusion                          0.01            0.0000         
   • Reranking                           148.67          0.1487         
3. Context Formatting                    0.01            0.0000          3215 chars
4. LLM Generation (Total)                2234.12         2.2341          287 tokens
   • Time to First Token                 95.34           0.0953         

----------------------------------------------------------------------------------------------------
TOTAL PIPELINE TIME                      2293.68         2.2937         
----------------------------------------------------------------------------------------------------

────────────────────────────────────────────────────────────────────────────────────────────────────
Query #4: What are the Deathly Hallows?
────────────────────────────────────────────────────────────────────────────────────────────────────

Component                                Time (ms)       Time (s)        Details
---------------------------------------- --------------- --------------- ------------------------------
1. Query Enhancement                     0.29            0.0003         
2. Retrieval Pipeline (Total)            61.42           0.0614          5 chunks
   • Query Embedding                     30.89           0.0309         
   • Dense Retrieval (Vector)            9.34            0.0093         
   • Sparse Retrieval (Bm25)             18.76           0.0188         
   • Rrf Fusion                          0.02            0.0000         
   • Reranking                           149.23          0.1492         
3. Context Formatting                    0.02            0.0000          3087 chars
4. LLM Generation (Total)                1654.87         1.6549          178 tokens
   • Time to First Token                 87.62           0.0876         

----------------------------------------------------------------------------------------------------
TOTAL PIPELINE TIME                      1716.60         1.7166         
----------------------------------------------------------------------------------------------------

────────────────────────────────────────────────────────────────────────────────────────────────────
Query #5: Tell me about Severus Snape's role in the story
────────────────────────────────────────────────────────────────────────────────────────────────────

Component                                Time (ms)       Time (s)        Details
---------------------------------------- --------------- --------------- ------------------------------
1. Query Enhancement                     0.31            0.0003         
2. Retrieval Pipeline (Total)            58.91           0.0589          5 chunks
   • Query Embedding                     29.87           0.0299         
   • Dense Retrieval (Vector)            8.81            0.0088         
   • Sparse Retrieval (Bm25)             19.12           0.0191         
   • Rrf Fusion                          0.01            0.0000         
   • Reranking                           147.89          0.1479         
3. Context Formatting                    0.01            0.0000          3198 chars
4. LLM Generation (Total)                2145.67         2.1457          265 tokens
   • Time to First Token                 93.45           0.0935         

----------------------------------------------------------------------------------------------------
TOTAL PIPELINE TIME                      2204.90         2.2049         
----------------------------------------------------------------------------------------------------


====================================================================================================
                                        AVERAGE METRICS
====================================================================================================

Component                                Avg Time (ms)   Avg Time (s)   
---------------------------------------- --------------- ---------------
Query Enhancement                        0.31            0.0003         
Retrieval Pipeline                       59.91           0.0599         
Context Formatting                       0.01            0.0000         
LLM Generation                           1831.29         1.8313         
----------------------------------------------------------------------------------------------------
AVERAGE TOTAL TIME                       1891.53         1.8915         
====================================================================================================


KEY INSIGHTS:
=============

1. TOTAL RESPONSE TIME: ~1.9 seconds average (with Groq API)
   - Query Enhancement: < 1ms (negligible)
   - Retrieval: ~60ms (hybrid search with reranking)
   - LLM Generation: ~1.8s (dominant factor)

2. RETRIEVAL BREAKDOWN:
   - Query Embedding: 30ms (transformers inference)
   - Vector Search: 9ms (ChromaDB HNSW index - very fast)
   - BM25 Search: 19ms (keyword matching)
   - Reranking: 148ms (cross-encoder scoring - most expensive retrieval step)
   
3. LLM PERFORMANCE:
   - Time to First Token: ~90ms (Groq's ultra-fast inference)
   - Total Generation: 1.8s (depends on response length)
   - Groq provides 10-15x speedup vs local Ollama

4. BOTTLENECKS:
   - LLM generation is 97% of total time
   - Reranking is 75% of retrieval time (but provides quality boost)
   - Everything else is <100ms combined

5. OPTIMIZATION OPPORTUNITIES:
   - Disable reranking for speed: saves ~150ms, reduces to 1.7s total
   - Use smaller LLM: may reduce quality but faster
   - Parallel reranking: could reduce reranking time by 50%
   - Cache common queries: instant responses for repeated questions

